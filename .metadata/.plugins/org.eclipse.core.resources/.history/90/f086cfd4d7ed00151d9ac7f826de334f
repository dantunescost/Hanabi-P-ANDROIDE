package model;

import java.util.HashMap;

import model.Couleur.CardColor;

/**
 * Represente les cartes du jeu Hanabi.
 */
public class Carte {
	/**
	 * La couleur de cette carte
	 * @see <a href="Couleur.html">Couleur</a>
	 */
	private final Couleur couleur;
	/**
	 * La valeur de cette carte
	 */
	private final int valeur;
	
	/**
	 * Indique si le joueur connait la couleur de cette carte dans sa main
	 * @see <a href="Main.html">Main</a>
	 * @see <a href="Joueur.html">Joueur</a>
	 */
	private boolean couleurConnue;
	/**
	 * Indique si le joueur connait la valeur de cette carte dans sa main
	 * @see <a href="Main.html">Main</a>
	 * @see <a href="Joueur.html">Joueur</a>
	 */
	private boolean valeurConnue;
	
	
	private HashMap<Couleur.CardColor, Boolean> couleursPossibles;
	
	private HashMap<Integer,Boolean> valeursPossibles;
			
	/**
	 * Constructeur d'une carte avec une couleur et une valeur definies
	 * @param couleur	La couleur voulue pour la carte
	 * @param valeur	La valeur voulue pour la carte
	 */
	public Carte(CardColor couleur, int valeur){
		this.couleur = new Couleur(couleur);
		this.valeur = valeur;
		this.valeurConnue = false;
		this.couleurConnue = false;
		
		couleursPossibles= new HashMap<Couleur.CardColor, Boolean>();
		couleursPossibles.put(Couleur.CardColor.BLANC, true);
		couleursPossibles.put(Couleur.CardColor.ROUGE, true);
		couleursPossibles.put(Couleur.CardColor.VERT, true);
		couleursPossibles.put(Couleur.CardColor.BLEU, true);
		couleursPossibles.put(Couleur.CardColor.JAUNE, true);
		
		valeursPossibles= new HashMap<Integer,Boolean>();
		valeursPossibles.put(1, true);
		valeursPossibles.put(2, true);
		valeursPossibles.put(3, true);
		valeursPossibles.put(4, true);
		valeursPossibles.put(5, true);
	}
	/**
	 * Permet de definir si cette carte n'est pas d'une couleur
	 * 
	 * @param c	désigne la couleur concernée
	 */
	public void setCouleurImpossible(Couleur.CardColor c){
		couleursPossibles.put(c,false);
	}
	/**
	 * Permet de definir si cette carte n'est pas d'une valeur
	 * 
	 * @param v	désigne la valeur concernée
	 */
	public void setValeurImpossible(int v){
		valeursPossibles.put(v,false);
	}
	
	/**
	 * @param c	désigne la couleur concernée
	 * @return 	Indique si cette carte peut être de cette couleur
	 */
	public boolean couleurPossible(Couleur.CardColor c) {
		return couleursPossibles.get(c);
	}
	
	/**
	 * @param v	désigne la couleur concernée
	 * @return 	Indique si cette carte peut être de cette valeur
	 */
	public boolean valeurPossible(int v) {
		return valeursPossibles.get(v);
	}
		
	
	
	/**
	 * @return 	Indique si le joueur connait la couleur de cette carte
	 */
	public boolean isCouleurConnue() {
		return couleurConnue;
	}
	

	/**
	 * Permet de definir si le joueur connait la couleur de cette carte
	 * 
	 * @param couleurConnue	Vaut true quand le joueur recoit un indice
	 */
	public void setCouleurConnue(boolean couleurConnue) {
		this.couleurConnue = couleurConnue;
	}
	

	/**
	 * @return	Indique si le joueur connait la valeur de cette carte
	 */
	public boolean isValeurConnue() {
		return valeurConnue;
	}
	

	/**
	 * Permet de definir si le joueur connait la valeur de cette carte
	 * @param valeurConnue	Vaut true quand le joueur recoit un indice
	 */
	public void setValeurConnue(boolean valeurConnue) {
		this.valeurConnue = valeurConnue;
	}
	
	

	/**
	 * @return	La couleur de cette carte
	 */
	public CardColor getCouleur() {
		return couleur.getCouleur();
	}
	
	
	/**
	 * @return	La valeur de cette carte
	 */
	public int getValeur() {
		return valeur;
	}
	
	/**
	 * @return	Le nom de la carte dans les ressources
	 */
	public String getCardName(){
		String res="";
		res += this.couleur.convertirEnChaine() + "_";
		res += Integer.toString(this.valeur) + ".png";
		return res; 
	}
	
	/**
	 * Permet de mettre à jour valeurConnue et couleurConnue en
	 * se basant sur les données de valeursImpossibles et
	 * couleursImpossibles
	 * 
	 * @param multi	vaut true si l'on est dans une partie avec des cartes multicolores
	 */
	public void majConnaissance(boolean multi){
		int nbCImpossibles=0;
		int nbVImpossibles=0;
		for(int i=0; i<Couleur.getAllCouleurs(multi).size();i++)
		{
			if(!(this.couleurPossible(Couleur.getAllCouleurs(multi).get(i))))
			{
				nbCImpossibles++;
			}
		}
		if(nbCImpossibles==Couleur.getAllCouleurs(multi).size()-1)
		{
			this.setCouleurConnue(true);
		}
		for(int i=1; i<6; i++)
		{
			if(!(this.valeurPossible(i)))
			{
				nbVImpossibles++;
			}
		}
		if(nbVImpossibles==4)
		{
			this.setCouleurConnue(true);
		}
	}
}
